---
title: "Group11_CitiBike"
group members: Emily Chang, Robert Konigsberg, Mahraan Qadir, Jason Wang, Jiaxin Zheng, Xialin Zou
date: Due Feb. 15, 2016
output: html_document
---

```{r}
library(plyr)
library(dplyr)
library(ggplot2)
library(ggmap)

citiBike <- read.csv("201511-citibike-tripdata.csv")

stations <- unique(subset(citiBike, select = c(start.station.id, start.station.name, start.station.latitude, start.station.longitude)))
nrow(unique(stations))

routes <- unique(subset(citiBike, select = c(start.station.id, end.station.id)))
nrow(unique(routes))
```

#Patterns in Ride History Data
Identify patterns in the ride history data. Explain these patterns using appropriate visualization. Two potential patterns are (this is an illustrative list, you should formulate your own patterns as well to be explored here):

####1. Which stations see the most asymmetric traffic (more arrivals than departures and vice versa)?
```{r}
endStation<-as.data.frame(table(citiBike$end.station.id))
startStation<-as.data.frame(table(citiBike$start.station.id))
stationData <- merge(startStation, endStation, by="Var1", all=TRUE)
stationData[is.na(stationData)] <- 0
names(stationData) <- c("station.id", "start.freq", "end.freq")
stationData$traffic <- stationData$start.freq - stationData$end.freq
```

The stations with the most outgoing traffic are:
```{r}
outTraffic <- stationData[order(stationData$traffic),]
head(outTraffic)
```

The stations with the most incoming traffic are:
```{r}
inTraffic <- stationData[order(-stationData$traffic),]
head(inTraffic)
```


####2. Which stations originate the longest rides? Does this change as we go through different times of the day?
```{r}
longestRide <- citiBike[order(citiBike$tripduration), ]
head(longestRide)
```

#Dataset Visualization
```{r}
qmplot(start.station.longitude, start.station.latitude, data = stations, maptype = "terrain", source='stamen')

qmplot(start.station.longitude, start.station.latitude, data = stations, maptype = "toner-background", darken = 0.7, geom = "blank", source='stamen') +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", alpha = .3, color = NA) +
  scale_fill_gradient2("Starting\nPoints", low = "white", mid = "yellow", high = "red", midpoint = 100)

```


#Business Issues
####Stations running out of bikes is a big problem. Client would want to know which stations are candidates for improving bike storage capacity.

```{r}
# The stations that are start stations the most number of times are likely the best candidates for a higher bike storage capacity
startStationCount <- as.data.frame(table(citiBike$start.station.id))
startStationCount <- startStationCount[order(startStationCount$Freq, decreasing=TRUE),]
head(startStationCount)
```


####Bike maintenance bills are piling up. Client thinks that this is because some bikes are being used a lot more than other bikes. Can you check on this assumption?

####Client is planning a promotion to increase bike rental by younger folks (age < 25) and tourists (i.e not an annual member). They want to focus on stations that are less used by these target groups. Can you help them identify these stations?


```{r}
# http://data.fcc.gov/api/block/2010/find?latitude=40.0&longitude=-85
```














